#!/bin/bash

# Pre-commit hook for Ease project
# Runs format check, analyze, and tests before allowing commit

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if melos is available
if ! command -v melos &> /dev/null; then
    echo "âŒ melos not found. Please run: dart pub global activate melos"
    exit 1
fi

# Format check
echo ""
echo "ğŸ“ Checking code format..."
if ! melos run format:check; then
    echo ""
    echo "âŒ Format check failed. Run 'melos run format' to fix."
    exit 1
fi
echo "âœ… Format check passed"

# Analyze
echo ""
echo "ğŸ”¬ Running analyzer..."
if ! melos run analyze; then
    echo ""
    echo "âŒ Analysis failed. Fix the issues above."
    exit 1
fi
echo "âœ… Analysis passed"

# Tests
echo ""
echo "ğŸ§ª Running tests..."
if ! melos run test:all; then
    echo ""
    echo "âŒ Tests failed. Fix the failing tests."
    exit 1
fi
echo "âœ… All tests passed"

echo ""
echo "âœ… All pre-commit checks passed!"
